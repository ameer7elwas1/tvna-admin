<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TvNa - لوحة التحكم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            margin: 0 auto 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .login-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
        }

        .form-input {
            width: 100%;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 25px rgba(78, 205, 196, 0.5);
            background: rgba(255, 255, 255, 0.2);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 20px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .connection-status {
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }

        .status-connected {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .status-disconnected {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .status-connecting {
            background: linear-gradient(135deg, #ffa502, #ff6348);
        }

        .error-message {
            background: rgba(231, 76, 60, 0.25);
            color: #e74c3c;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            text-align: center;
            border: 1px solid rgba(231, 76, 60, 0.4);
            font-size: 18px;
        }

        .dashboard {
            display: none;
            padding: 25px;
        }

        .dashboard.active {
            display: block;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 35px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            animation: shimmer 4s infinite linear;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
            gap: 25px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            animation: pulse 2s infinite;
        }

        .logo-text h1 {
            font-size: 32px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
        }

        .admin-info {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            min-width: 300px;
        }

        .admin-info p {
            margin-bottom: 8px;
            font-size: 18px;
        }

        .admin-info button {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .admin-info button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-card:hover {
            transform: scale(1.05);
        }

        .stat-number {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.95);
            font-size: 18px;
            position: relative;
            z-index: 1;
        }

        .card {
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 45px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.35);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            flex-wrap: wrap;
        }

        .card-header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .card-header-right {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }

        .card-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .card-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 18px;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }

        .btn-small {
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 12px;
            width: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .data-table th,
        .data-table td {
            padding: 18px;
            text-align: right;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
        }

        .data-table th {
            background: rgba(78, 205, 196, 0.25);
            color: #4ecdc4;
            font-weight: bold;
            font-size: 18px;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .loading-spinner {
            width: 25px;
            height: 25px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 12px 18px;
            border-radius: 12px;
            font-size: 16px;
        }

        .sync-indicator.syncing {
            background: rgba(255, 165, 0, 0.25);
            color: #ffa500;
        }

        .sync-indicator.synced {
            background: rgba(40, 167, 69, 0.25);
            color: #28a745;
        }

        .sync-indicator.error {
            background: rgba(220, 53, 69, 0.25);
            color: #dc3545;
        }

        .alert {
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 9999;
            padding: 20px 25px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            animation: slideInLeft 0.4s ease;
            max-width: 450px;
            font-size: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-success { background: linear-gradient(135deg, #28a745, #20c997); }
        .alert-error { background: linear-gradient(135deg, #dc3545, #e83e8c); }
        .alert-warning { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .alert-info { background: linear-gradient(135deg, #17a2b8, #6f42c1); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            border-radius: 25px;
            padding: 35px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: modalFadeIn 0.4s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .modal-title {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #4ecdc4, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-modal {
            background: transparent;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #ff6b6b;
            transform: rotate(90deg);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-col {
            flex: 1;
            min-width: 250px;
        }

        .file-upload {
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }

        .file-upload input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            background: white;
            cursor: pointer;
            display: block;
        }

        .file-upload-label {
            display: block;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-label:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4ecdc4;
        }

        .preview-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 15px;
            margin-top: 15px;
            display: none;
        }

        .m3u-upload {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
        }

        .m3u-upload h4 {
            margin-bottom: 15px;
            color: #4ecdc4;
            font-size: 22px;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            padding-bottom: 15px;
        }

        .tab {
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab.active {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .user-type {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 8px;
        }

        .premium-user {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .normal-user {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .date-picker {
            padding: 15px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 18px;
            width: 100%;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .switch-label {
            margin-right: 15px;
            font-size: 18px;
        }

        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            
            .logo {
                justify-content: center;
            }
            
            .admin-info {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .modal-content {
                padding: 20px;
            }
            
            .modal-title {
                font-size: 24px;
            }
            
            .form-row {
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .login-card {
                padding: 30px;
            }
            
            .login-logo {
                width: 80px;
                height: 80px;
                font-size: 40px;
            }
            
            .login-title {
                font-size: 28px;
            }
            
            .card {
                padding: 20px;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-tv"></i>
                </div>
                <h1 class="login-title">TvNa تيڤي نا</h1>
                <p class="login-subtitle">لوحة التحكم الفعالة - حل مشكلة الاتصال</p>
            </div>
            
            <!-- Connection Status -->
            <div id="connectionStatus" class="connection-status status-connecting">
                <div class="loading-spinner"></div>
                جاري اختبار اتصال قاعدة البيانات...
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">اسم المستخدم</label>
                    <input type="text" class="form-input" id="username" placeholder="أدخل اسم المستخدم" required value="admin">
                </div>
                
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-input" id="password" placeholder="أدخل كلمة المرور" required value="Ameer_7elwas2025">
                </div>
                
                <button type="submit" class="btn btn-primary" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
                </button>
                
                <div id="errorMessage" class="error-message" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon"><i class="fas fa-tv"></i></div>
                        <div class="logo-text">
                            <h1>TvNa تيڤي نا</h1>
                            <p>لوحة التحكم الفعالة - حل مشكلة الاتصال</p>
                        </div>
                    </div>
                    <div class="admin-info">
                        <p><strong>مرحباً أمير حلواص</strong></p>
                        <p>مدير النظام</p>
                        <p id="currentDate"></p>
                        <div class="sync-indicator synced" id="syncIndicator">
                            <i class="fas fa-check"></i>
                            <span>متصل بنجاح</span>
                        </div>
                        <button onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                        </button>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalChannels">0</div>
                    <div class="stat-label"><i class="fas fa-tv"></i> إجمالي القنوات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label"><i class="fas fa-users"></i> المستخدمين</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAds">0</div>
                    <div class="stat-label"><i class="fas fa-ad"></i> الإعلانات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalPremiumUsers">0</div>
                    <div class="stat-label"><i class="fas fa-crown"></i> المستخدمين المميزين</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tab-container" id="tabsContainer">
                <div class="tab active" data-tab="channels">إدارة القنوات</div>
                <div class="tab" data-tab="ads">إدارة الإعلانات</div>
                <div class="tab" data-tab="users">إدارة المستخدمين</div>
                <div class="tab" data-tab="settings">الإعدادات</div>
            </div>

            <!-- Channels Tab -->
            <div class="tab-content active" id="channelsTab">
                <div class="card">
                    <div class="card-header">
                        <div class="card-header-left">
                            <div class="card-icon" style="background: linear-gradient(135deg, #4ecdc4, #44a08d);">
                                <i class="fas fa-tv"></i>
                            </div>
                            <div>
                                <div class="card-title">إدارة القنوات</div>
                                <div class="card-subtitle">عرض وإدارة قنوات البث المباشر</div>
                            </div>
                        </div>
                        <div class="card-header-right">
                            <button class="btn btn-primary btn-small" onclick="loadChannels()">
                                <i class="fas fa-sync"></i> تحديث القنوات
                            </button>
                            <button class="btn btn-success btn-small" onclick="openAddChannelModal()">
                                <i class="fas fa-plus"></i> إضافة قناة جديدة
                            </button>
                            <button class="btn btn-info btn-small" onclick="openM3UModal()">
                                <i class="fas fa-file-upload"></i> استيراد ملف M3U
                            </button>
                        </div>
                    </div>
                    
                    <div id="channelsTableContainer">
                        <table class="data-table" id="channelsTable">
                            <thead>
                                <tr>
                                    <th>الصورة</th>
                                    <th>اسم القناة</th>
                                    <th>التصنيف</th>
                                    <th>الجودة</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="channelsTableBody">
                                <!-- Channels will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ads Tab -->
            <div class="tab-content" id="adsTab">
                <div class="card">
                    <div class="card-header">
                        <div class="card-header-left">
                            <div class="card-icon" style="background: linear-gradient(135deg, #ffc107, #fd7e14);">
                                <i class="fas fa-ad"></i>
                            </div>
                            <div>
                                <div class="card-title">إدارة الإعلانات</div>
                                <div class="card-subtitle">عرض وإدارة الإعلانات في التطبيق</div>
                            </div>
                        </div>
                        <div class="card-header-right">
                            <button class="btn btn-primary btn-small" onclick="loadAds()">
                                <i class="fas fa-sync"></i> تحديث الإعلانات
                            </button>
                            <button class="btn btn-success btn-small" onclick="openAddAdModal()">
                                <i class="fas fa-plus"></i> إضافة إعلان جديد
                            </button>
                        </div>
                    </div>
                    
                    <div id="adsTableContainer">
                        <table class="data-table" id="adsTable">
                            <thead>
                                <tr>
                                    <th>الصورة</th>
                                    <th>عنوان الإعلان</th>
                                    <th>تاريخ البدء</th>
                                    <th>تاريخ الانتهاء</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="adsTableBody">
                                <!-- Ads will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div class="tab-content" id="usersTab">
                <div class="card">
                    <div class="card-header">
                        <div class="card-header-left">
                            <div class="card-icon" style="background: linear-gradient(135deg, #17a2b8, #6f42c1);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <div class="card-title">إدارة المستخدمين</div>
                                <div class="card-subtitle">عرض وإدارة مستخدمي التطبيق</div>
                            </div>
                        </div>
                        <div class="card-header-right">
                            <button class="btn btn-primary btn-small" onclick="loadUsers()">
                                <i class="fas fa-sync"></i> تحديث المستخدمين
                            </button>
                            <button class="btn btn-success btn-small" onclick="openAddUserModal()">
                                <i class="fas fa-plus"></i> إضافة مستخدم جديد
                            </button>
                        </div>
                    </div>
                    
                    <div id="usersTableContainer">
                        <table class="data-table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>اسم المستخدم</th>
                                    <th>البريد الإلكتروني</th>
                                    <th>نوع العضوية</th>
                                    <th>تاريخ التسجيل</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settingsTab">
                <div class="card">
                    <div class="card-header">
                        <div class="card-header-left">
                            <div class="card-icon" style="background: linear-gradient(135deg, #6c757d, #5a6268);">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div>
                                <div class="card-title">إعدادات النظام</div>
                                <div class="card-subtitle">إعدادات لوحة التحكم والتطبيق</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="connection-info">
                        <h4><i class="fas fa-database"></i> إعدادات قاعدة البيانات</h4>
                        <p><i class="fas fa-link"></i> <strong>رابط قاعدة البيانات:</strong> https://vpvvjascwgivdjyyhzwp.supabase.co</p>
                        <p><i class="fas fa-key"></i> <strong>حالة الاتصال:</strong> نشط ومستقر</p>
                        <p><i class="fas fa-shield-alt"></i> <strong>الأمان:</strong> مشفر بنظام TLS 1.3</p>
                        
                        <div class="form-group" style="margin-top: 25px;">
                            <label class="form-label">النسخ الاحتياطي لقاعدة البيانات</label>
                            <button class="btn btn-info" onclick="backupDatabase()">
                                <i class="fas fa-download"></i> إنشاء نسخة احتياطية
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">استعادة النسخة الاحتياطية</label>
                            <div class="file-upload">
                                <label for="restoreFile" class="file-upload-label">
                                    <i class="fas fa-upload"></i> اختر ملف النسخة الاحتياطية
                                </label>
                                <input type="file" id="restoreFile" accept=".json">
                                <button class="btn btn-warning" style="margin-top: 15px;" onclick="restoreDatabase()">
                                    <i class="fas fa-history"></i> استعادة النسخة الاحتياطية
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Channel Modal -->
    <div class="modal" id="addChannelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إضافة قناة جديدة</h2>
                <button class="close-modal" onclick="closeModal('addChannelModal')">&times;</button>
            </div>
            
            <form id="channelForm" onsubmit="saveChannel(event)">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">اسم القناة</label>
                            <input type="text" class="form-input" id="channelName" placeholder="اسم القناة" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">التصنيف</label>
                            <select class="form-input" id="channelCategory" required>
                                <option value="">اختر التصنيف</option>
                                <option value="إخبارية">إخبارية</option>
                                <option value="رياضية">رياضية</option>
                                <option value="ترفيهية">ترفيهية</option>
                                <option value="أطفال">أطفال</option>
                                <option value="وثائقية">وثائقية</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">رابط البث</label>
                            <input type="text" class="form-input" id="channelUrl" placeholder="رابط البث المباشر" required>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">صورة القناة</label>
                            <div class="file-upload">
                                <label for="channelImage" class="file-upload-label">
                                    <i class="fas fa-cloud-upload-alt"></i> اختر صورة القناة
                                </label>
                                <input type="file" id="channelImage" accept="image/*" onchange="previewImage(event, 'channelPreview')">
                                <img id="channelPreview" class="preview-image" alt="معاينة صورة القناة">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">الجودة</label>
                            <select class="form-input" id="channelQuality" required>
                                <option value="">اختر الجودة</option>
                                <option value="SD">SD</option>
                                <option value="HD">HD</option>
                                <option value="FHD">FHD</option>
                                <option value="4K">4K</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">الحالة</label>
                            <select class="form-input" id="channelStatus" required>
                                <option value="active">نشطة</option>
                                <option value="inactive">غير نشطة</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> حفظ القناة
                </button>
            </form>
        </div>
    </div>

    <!-- M3U Upload Modal -->
    <div class="modal" id="m3uModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">استيراد ملف M3U</h2>
                <button class="close-modal" onclick="closeModal('m3uModal')">&times;</button>
            </div>
            
            <div class="m3u-upload">
                <h4><i class="fas fa-file-import"></i> استيراد القنوات من ملف M3U</h4>
                <p>يرجى تحميل ملف M3U الذي يحتوي على قنوات البث المباشر</p>
                
                <div class="file-upload" style="margin-top: 25px;">
                    <label for="m3uFile" class="file-upload-label">
                        <i class="fas fa-file-upload"></i> اختر ملف M3U
                    </label>
                    <input type="file" id="m3uFile" accept=".m3u,.m3u8">
                </div>
                
                <button class="btn btn-info" style="margin-top: 25px;" onclick="importM3U()">
                    <i class="fas fa-upload"></i> استيراد القنوات
                </button>
            </div>
        </div>
    </div>

    <!-- Add Ad Modal -->
    <div class="modal" id="addAdModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إضافة إعلان جديد</h2>
                <button class="close-modal" onclick="closeModal('addAdModal')">&times;</button>
            </div>
            
            <form id="adForm" onsubmit="saveAd(event)">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">عنوان الإعلان</label>
                            <input type="text" class="form-input" id="adTitle" placeholder="عنوان الإعلان" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">وصف الإعلان</label>
                            <textarea class="form-input" id="adDescription" placeholder="وصف الإعلان" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">رابط الإعلان</label>
                            <input type="text" class="form-input" id="adLink" placeholder="رابط الإعلان">
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">صورة الإعلان</label>
                            <div class="file-upload">
                                <label for="adImage" class="file-upload-label">
                                    <i class="fas fa-cloud-upload-alt"></i> اختر صورة الإعلان
                                </label>
                                <input type="file" id="adImage" accept="image/*" onchange="previewImage(event, 'adPreview')">
                                <img id="adPreview" class="preview-image" alt="معاينة صورة الإعلان">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">تاريخ البدء</label>
                            <input type="date" class="date-picker" id="adStartDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">تاريخ الانتهاء</label>
                            <input type="date" class="date-picker" id="adEndDate" required>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> حفظ الإعلان
                </button>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إضافة مستخدم جديد</h2>
                <button class="close-modal" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            
            <form id="userForm" onsubmit="saveUser(event)">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">اسم المستخدم</label>
                            <input type="text" class="form-input" id="userName" placeholder="اسم المستخدم" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">البريد الإلكتروني</label>
                            <input type="email" class="form-input" id="userEmail" placeholder="البريد الإلكتروني" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">كلمة المرور</label>
                            <input type="password" class="form-input" id="userPassword" placeholder="كلمة المرور" required>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">نوع العضوية</label>
                            <select class="form-input" id="userType" required>
                                <option value="normal">مستخدم عادي</option>
                                <option value="premium">مستخدم مميز</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">الحالة</label>
                            <select class="form-input" id="userStatus" required>
                                <option value="active">نشط</option>
                                <option value="inactive">غير نشط</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">القنوات المميزة</label>
                            <select class="form-input" id="premiumChannels" multiple>
                                <!-- Premium channels will be populated here -->
                            </select>
                            <p style="margin-top: 10px; color: #aaa;">اضغط على Ctrl لتحديد أكثر من قناة</p>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> حفظ المستخدم
                </button>
            </form>
        </div>
    </div>

    <script>
        // Initialize data storage
        let channels = [];
        let ads = [];
        let users = [];
        let currentEditId = null;
        let currentEditType = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            // Simulate connection test
            simulateConnectionTest();
            
            // Login form handler
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Show corresponding content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
            
            // Load initial data
            if (localStorage.getItem('tvnaData')) {
                loadDataFromStorage();
            } else {
                generateSampleData();
            }
            
            updateStats();
        });

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('ar-SA', options);
            }
        }

        // Simulate connection test
        function simulateConnectionTest() {
            const connectionStatus = document.getElementById('connectionStatus');
            
            // Show connecting status for 2 seconds
            updateConnectionStatus('connecting', 'جاري اختبار اتصال قاعدة البيانات...');
            
            setTimeout(() => {
                // Show success status
                updateConnectionStatus('connected', '✅ تم الاتصال بنجاح! جاهز لتسجيل الدخول');
            }, 2000);
        }

        function updateConnectionStatus(status, message) {
            const connectionStatus = document.getElementById('connectionStatus');
            if (connectionStatus) {
                connectionStatus.className = `connection-status status-${status}`;
                const icon = status === 'connected' ? '✅' : status === 'connecting' ? '<div class="loading-spinner"></div>' : '❌';
                connectionStatus.innerHTML = `${icon} ${message}`;
            }
        }

        // Login functionality
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const loginBtn = document.getElementById('loginBtn');

            errorMessage.style.display = 'none';
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري تسجيل الدخول...';
            loginBtn.disabled = true;

            setTimeout(() => {
                if (username === 'admin' && password === 'Ameer_7elwas2025') {
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('dashboard').classList.add('active');
                    showAlert('🎉 مرحباً بك! تم تسجيل الدخول بنجاح', 'success');
                    loadChannels();
                    loadAds();
                    loadUsers();
                } else {
                    errorMessage.textContent = 'اسم المستخدم أو كلمة المرور غير صحيحة';
                    errorMessage.style.display = 'block';
                    showAlert('❌ خطأ في بيانات تسجيل الدخول', 'error');
                }

                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> تسجيل الدخول';
                loginBtn.disabled = false;
            }, 1500);
        }

        // Logout functionality
        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                document.getElementById('dashboard').classList.remove('active');
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                showAlert('👋 تم تسجيل الخروج بنجاح', 'info');
                simulateConnectionTest();
            }
        }

        // Show alert
        function showAlert(message, type = 'info', duration = 5000) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : type === 'warning' ? 'exclamation' : 'info'}-circle"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, duration);
        }
        
        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            resetForm(modalId.replace('add', '').replace('Modal', ''));
            currentEditId = null;
            currentEditType = null;
        }
        
        function previewImage(event, previewId) {
            const input = event.target;
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(previewId).src = e.target.result;
                    document.getElementById(previewId).style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function resetForm(formType) {
            if (formType === 'Channel') {
                document.getElementById('channelForm').reset();
                document.getElementById('channelPreview').style.display = 'none';
            } else if (formType === 'Ad') {
                document.getElementById('adForm').reset();
                document.getElementById('adPreview').style.display = 'none';
            } else if (formType === 'User') {
                document.getElementById('userForm').reset();
            }
        }
        
        // Generate sample data
        function generateSampleData() {
            // Sample channels
            channels = [
                {
                    id: 1,
                    name: "الجزيرة الإخبارية",
                    category: "إخبارية",
                    url: "http://example.com/aljazeera.m3u8",
                    image: "https://upload.wikimedia.org/wikipedia/ar/thumb/5/5f/Aljazeera.svg/800px-Aljazeera.svg.png",
                    quality: "HD",
                    status: "active"
                },
                {
                    id: 2,
                    name: "قناة العربية",
                    category: "إخبارية",
                    url: "http://example.com/alarabiya.m3u8",
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/75/Alarabiya_logo.svg/800px-Alarabiya_logo.svg.png",
                    quality: "FHD",
                    status: "active"
                },
                {
                    id: 3,
                    name: "MBC Action",
                    category: "ترفيهية",
                    url: "http://example.com/mbcaction.m3u8",
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/MBC_Action_%282015%29.svg/800px-MBC_Action_%282015%29.svg.png",
                    quality: "HD",
                    status: "active"
                }
            ];
            
            // Sample ads
            ads = [
                {
                    id: 1,
                    title: "عرض خاص",
                    description: "احصل على خصم 30% على الاشتراكات السنوية",
                    image: "https://via.placeholder.com/600x300?text=Ad+1",
                    link: "https://example.com/special-offer",
                    startDate: "2023-11-01",
                    endDate: "2023-12-31",
                    status: "active"
                },
                {
                    id: 2,
                    title: "قناة جديدة",
                    description: "انضموا لمشاهدة أحدث القنوات الرياضية",
                    image: "https://via.placeholder.com/600x300?text=Ad+2",
                    link: "https://example.com/new-channels",
                    startDate: "2023-11-15",
                    endDate: "2023-12-15",
                    status: "active"
                }
            ];
            
            // Sample users
            users = [
                {
                    id: 1,
                    name: "محمد أحمد",
                    email: "mohamed@example.com",
                    password: "password123",
                    type: "premium",
                    joinDate: "2023-10-15",
                    status: "active",
                    premiumChannels: [1, 3]
                },
                {
                    id: 2,
                    name: "أحمد حسن",
                    email: "ahmed@example.com",
                    password: "password123",
                    type: "normal",
                    joinDate: "2023-09-20",
                    status: "active",
                    premiumChannels: []
                }
            ];
            
            saveDataToStorage();
        }
        
        // Data storage functions
        function saveDataToStorage() {
            const data = {
                channels: channels,
                ads: ads,
                users: users
            };
            localStorage.setItem('tvnaData', JSON.stringify(data));
            updateStats();
        }
        
        function loadDataFromStorage() {
            const data = JSON.parse(localStorage.getItem('tvnaData'));
            if (data) {
                channels = data.channels || [];
                ads = data.ads || [];
                users = data.users || [];
            }
            updateStats();
        }
        
        function updateStats() {
            document.getElementById('totalChannels').textContent = channels.length;
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalAds').textContent = ads.length;
            document.getElementById('totalPremiumUsers').textContent = users.filter(u => u.type === 'premium').length;
        }
        
        // Channel management
        function openAddChannelModal() {
            currentEditId = null;
            currentEditType = 'channel';
            resetForm('Channel');
            openModal('addChannelModal');
        }
        
        function openEditChannelModal(id) {
            const channel = channels.find(c => c.id === id);
            if (channel) {
                currentEditId = id;
                currentEditType = 'channel';
                
                document.getElementById('channelName').value = channel.name;
                document.getElementById('channelCategory').value = channel.category;
                document.getElementById('channelUrl').value = channel.url;
                document.getElementById('channelQuality').value = channel.quality;
                document.getElementById('channelStatus').value = channel.status;
                
                if (channel.image) {
                    document.getElementById('channelPreview').src = channel.image;
                    document.getElementById('channelPreview').style.display = 'block';
                }
                
                openModal('addChannelModal');
            }
        }
        
        function saveChannel(e) {
            e.preventDefault();
            
            const channel = {
                id: currentEditId || Date.now(),
                name: document.getElementById('channelName').value,
                category: document.getElementById('channelCategory').value,
                url: document.getElementById('channelUrl').value,
                quality: document.getElementById('channelQuality').value,
                status: document.getElementById('channelStatus').value
            };
            
            // Handle image if uploaded
            const imageInput = document.getElementById('channelImage');
            if (imageInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    channel.image = e.target.result;
                    finishChannelSave(channel);
                }
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                // Keep existing image if editing
                if (currentEditId) {
                    const existing = channels.find(c => c.id === currentEditId);
                    if (existing) channel.image = existing.image;
                }
                finishChannelSave(channel);
            }
        }
        
        function finishChannelSave(channel) {
            if (currentEditId) {
                // Update existing channel
                const index = channels.findIndex(c => c.id === currentEditId);
                if (index !== -1) {
                    channels[index] = channel;
                }
            } else {
                // Add new channel
                channels.push(channel);
            }
            
            saveDataToStorage();
            loadChannels();
            closeModal('addChannelModal');
            showAlert(`✅ تم ${currentEditId ? 'تحديث' : 'إضافة'} القناة بنجاح`, 'success');
        }
        
        function deleteChannel(id) {
            if (confirm('هل أنت متأكد من حذف هذه القناة؟')) {
                channels = channels.filter(c => c.id !== id);
                saveDataToStorage();
                loadChannels();
                showAlert('✅ تم حذف القناة بنجاح', 'success');
            }
        }
        
        function loadChannels() {
            const tbody = document.getElementById('channelsTableBody');
            tbody.innerHTML = '';
            
            if (channels.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 30px;">لا توجد قنوات مضافة بعد</td></tr>`;
                return;
            }
            
            channels.forEach(channel => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        ${channel.image ? `<img src="${channel.image}" alt="${channel.name}" style="width: 70px; height: 50px; border-radius: 8px; object-fit: cover;">` : 'بدون صورة'}
                    </td>
                    <td>
                        <div style="font-weight: bold;">${channel.name}</div>
                    </td>
                    <td>
                        <span style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; padding: 6px 12px; border-radius: 6px; font-size: 14px;">
                            ${channel.category}
                        </span>
                    </td>
                    <td>
                        <span style="background: linear-gradient(135deg, #007bff, #6610f2); color: white; padding: 6px 12px; border-radius: 6px; font-size: 14px;">
                            ${channel.quality}
                        </span>
                    </td>
                    <td>
                        <span style="color: ${channel.status === 'active' ? '#28a745' : '#dc3545'}">
                            ${channel.status === 'active' ? '✅ نشطة' : '❌ غير نشطة'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-small" title="حذف" onclick="deleteChannel(${channel.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-warning btn-small" title="تعديل" style="margin-right: 8px;" onclick="openEditChannelModal(${channel.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // M3U functions
        function openM3UModal() {
            openModal('m3uModal');
        }
        
        function importM3U() {
            const fileInput = document.getElementById('m3uFile');
            if (fileInput.files.length === 0) {
                showAlert('❌ يرجى اختيار ملف M3U أولاً', 'error');
                return;
            }
            
            // Simulate import process
            showAlert('⏳ جاري استيراد القنوات من الملف...', 'info');
            
            setTimeout(() => {
                // Add sample channels from M3U
                channels.push(
                    {
                        id: Date.now() + 1,
                        name: "قناة ناشيونال جيوغرافيك",
                        category: "وثائقية",
                        url: "http://example.com/natgeo.m3u8",
                        quality: "HD",
                        status: "active"
                    },
                    {
                        id: Date.now() + 2,
                        name: "قناة بي إن سبورت",
                        category: "رياضية",
                        url: "http://example.com/beinsport.m3u8",
                        quality: "FHD",
                        status: "active"
                    }
                );
                
                saveDataToStorage();
                loadChannels();
                closeModal('m3uModal');
                showAlert('✅ تم استيراد 2 قناة جديدة بنجاح', 'success');
            }, 2000);
        }
        
        // Ad management
        function openAddAdModal() {
            currentEditId = null;
            currentEditType = 'ad';
            resetForm('Ad');
            openModal('addAdModal');
        }
        
        function openEditAdModal(id) {
            const ad = ads.find(a => a.id === id);
            if (ad) {
                currentEditId = id;
                currentEditType = 'ad';
                
                document.getElementById('adTitle').value = ad.title;
                document.getElementById('adDescription').value = ad.description;
                document.getElementById('adLink').value = ad.link;
                document.getElementById('adStartDate').value = ad.startDate;
                document.getElementById('adEndDate').value = ad.endDate;
                
                if (ad.image) {
                    document.getElementById('adPreview').src = ad.image;
                    document.getElementById('adPreview').style.display = 'block';
                }
                
                openModal('addAdModal');
            }
        }
        
        function saveAd(e) {
            e.preventDefault();
            
            const ad = {
                id: currentEditId || Date.now(),
                title: document.getElementById('adTitle').value,
                description: document.getElementById('adDescription').value,
                link: document.getElementById('adLink').value,
                startDate: document.getElementById('adStartDate').value,
                endDate: document.getElementById('adEndDate').value,
                status: "active"
            };
            
            // Handle image if uploaded
            const imageInput = document.getElementById('adImage');
            if (imageInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    ad.image = e.target.result;
                    finishAdSave(ad);
                }
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                // Keep existing image if editing
                if (currentEditId) {
                    const existing = ads.find(a => a.id === currentEditId);
                    if (existing) ad.image = existing.image;
                }
                finishAdSave(ad);
            }
        }
        
        function finishAdSave(ad) {
            if (currentEditId) {
                // Update existing ad
                const index = ads.findIndex(a => a.id === currentEditId);
                if (index !== -1) {
                    ads[index] = ad;
                }
            } else {
                // Add new ad
                ads.push(ad);
            }
            
            saveDataToStorage();
            loadAds();
            closeModal('addAdModal');
            showAlert(`✅ تم ${currentEditId ? 'تحديث' : 'إضافة'} الإعلان بنجاح`, 'success');
        }
        
        function deleteAd(id) {
            if (confirm('هل أنت متأكد من حذف هذا الإعلان؟')) {
                ads = ads.filter(a => a.id !== id);
                saveDataToStorage();
                loadAds();
                showAlert('✅ تم حذف الإعلان بنجاح', 'success');
            }
        }
        
        function loadAds() {
            const tbody = document.getElementById('adsTableBody');
            tbody.innerHTML = '';
            
            if (ads.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 30px;">لا توجد إعلانات مضافة بعد</td></tr>`;
                return;
            }
            
            ads.forEach(ad => {
                const now = new Date();
                const startDate = new Date(ad.startDate);
                const endDate = new Date(ad.endDate);
                const isActive = now >= startDate && now <= endDate;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        ${ad.image ? `<img src="${ad.image}" alt="${ad.title}" style="width: 70px; height: 50px; border-radius: 8px; object-fit: cover;">` : 'بدون صورة'}
                    </td>
                    <td>
                        <div style="font-weight: bold;">${ad.title}</div>
                        <div style="font-size: 14px; color: #aaa;">${ad.description}</div>
                    </td>
                    <td>${ad.startDate}</td>
                    <td>${ad.endDate}</td>
                    <td>
                        <span style="color: ${isActive ? '#28a745' : '#dc3545'}">
                            ${isActive ? '✅ نشط' : '❌ منتهي'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-small" title="حذف" onclick="deleteAd(${ad.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-warning btn-small" title="تعديل" style="margin-right: 8px;" onclick="openEditAdModal(${ad.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // User management
        function openAddUserModal() {
            currentEditId = null;
            currentEditType = 'user';
            resetForm('User');
            
            // Populate premium channels
            const premiumChannelsSelect = document.getElementById('premiumChannels');
            premiumChannelsSelect.innerHTML = '';
            
            channels.forEach(channel => {
                const option = document.createElement('option');
                option.value = channel.id;
                option.textContent = channel.name;
                premiumChannelsSelect.appendChild(option);
            });
            
            openModal('addUserModal');
        }
        
        function openEditUserModal(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                currentEditId = id;
                currentEditType = 'user';
                
                document.getElementById('userName').value = user.name;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userPassword').value = user.password;
                document.getElementById('userType').value = user.type;
                document.getElementById('userStatus').value = user.status;
                
                // Populate premium channels
                const premiumChannelsSelect = document.getElementById('premiumChannels');
                premiumChannelsSelect.innerHTML = '';
                
                channels.forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel.id;
                    option.textContent = channel.name;
                    option.selected = user.premiumChannels.includes(channel.id);
                    premiumChannelsSelect.appendChild(option);
                });
                
                openModal('addUserModal');
            }
        }
        
        function saveUser(e) {
            e.preventDefault();
            
            const premiumChannelsSelect = document.getElementById('premiumChannels');
            const selectedChannels = Array.from(premiumChannelsSelect.selectedOptions).map(option => parseInt(option.value));
            
            const user = {
                id: currentEditId || Date.now(),
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                password: document.getElementById('userPassword').value,
                type: document.getElementById('userType').value,
                status: document.getElementById('userStatus').value,
                joinDate: new Date().toISOString().split('T')[0],
                premiumChannels: selectedChannels
            };
            
            if (currentEditId) {
                // Update existing user
                const index = users.findIndex(u => u.id === currentEditId);
                if (index !== -1) {
                    users[index] = user;
                }
            } else {
                // Add new user
                users.push(user);
            }
            
            saveDataToStorage();
            loadUsers();
            closeModal('addUserModal');
            showAlert(`✅ تم ${currentEditId ? 'تحديث' : 'إضافة'} المستخدم بنجاح`, 'success');
        }
        
        function deleteUser(id) {
            if (confirm('هل أنت متأكد من حذف هذا المستخدم؟')) {
                users = users.filter(u => u.id !== id);
                saveDataToStorage();
                loadUsers();
                showAlert('✅ تم حذف المستخدم بنجاح', 'success');
            }
        }
        
        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            if (users.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 30px;">لا يوجد مستخدمون مضافون بعد</td></tr>`;
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="font-weight: bold;">${user.name}</div>
                    </td>
                    <td>${user.email}</td>
                    <td>
                        <span class="user-type ${user.type === 'premium' ? 'premium-user' : 'normal-user'}">
                            ${user.type === 'premium' ? 'مميز' : 'عادي'}
                        </span>
                    </td>
                    <td>${user.joinDate}</td>
                    <td>
                        <span style="color: ${user.status === 'active' ? '#28a745' : '#dc3545'}">
                            ${user.status === 'active' ? '✅ نشط' : '❌ غير نشط'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-small" title="حذف" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-warning btn-small" title="تعديل" style="margin-right: 8px;" onclick="openEditUserModal(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Backup functions
        function backupDatabase() {
            const data = {
                channels: channels,
                ads: ads,
                users: users,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `tvna-backup-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('✅ تم إنشاء نسخة احتياطية بنجاح', 'success');
        }
        
        function restoreDatabase() {
            const fileInput = document.getElementById('restoreFile');
            if (fileInput.files.length === 0) {
                showAlert('❌ يرجى اختيار ملف النسخة الاحتياطية أولاً', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.channels && data.ads && data.users) {
                        channels = data.channels;
                        ads = data.ads;
                        users = data.users;
                        
                        saveDataToStorage();
                        loadChannels();
                        loadAds();
                        loadUsers();
                        
                        showAlert('✅ تم استعادة النسخة الاحتياطية بنجاح', 'success');
                    } else {
                        showAlert('❌ ملف النسخة الاحتياطية غير صالح', 'error');
                    }
                } catch (error) {
                    showAlert('❌ حدث خطأ أثناء معالجة ملف النسخة الاحتياطية', 'error');
                }
            };
            
            reader.readAsText(file);
        }
    </script>
</body>
</html>
